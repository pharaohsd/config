#!/usr/bin/env ruby
# Author: Gigamo <gigamo@gmail.com>
# Wrote this because I'm too lazy to upload manually all the time
# Requires scrot, imagemagick and ncftp
FTPHOST = "users.telenet.be"
FTPPATH = "pics"
FTPUSER = ""
FTPPASS = ""
PICPATH = "~/screenshots/" # Include trailing slash or leave blank to save in working directory
NO_CLEAN = 0 # Remove the files locally afterwards or not

PICNAME = ARGV

def usage
  puts "No filename specified! Usage: screenshot [name]\n\n    For example   - screenshot current\n                  -> would scrot a screenshot named current.png"
  exit 0
end

def link
  puts "\nLink:\n\nhttp://#{FTPHOST}/gigamo/#{FTPPATH}/#{PICNAME}.png"
end

def printscreen
  if File.executable? "/usr/bin/scrot" and File.executable? "/usr/bin/mogrify"
    `scrot #{PICPATH}#{PICNAME}.png && cp #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png && mogrify -resize 25% #{PICPATH}#{PICNAME}t.png`
  else
    puts "Please install scrot and/or imagemagick"
  end
end

def upload
  if File.executable? "/usr/bin/ncftp"
    `ncftpput -u #{FTPUSER} -p #{FTPPASS} -R -m #{FTPHOST} #{FTPPATH} #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png`
    puts "\nUpload succesful!"
  else
    puts "Please install ncftp"
  end
end

def clean
  `rm -f #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png`
end

if ARGV.empty?
  usage
else
  printscreen
  upload
  link
  if NO_CLEAN == 0
    clean
  end
  exit 0
end
