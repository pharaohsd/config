#!/bin/bash
#
# (c) Gigamo 2008
#
# Requires scrot, imagemagick and ncftp
#     
#     Arch users can just "pacman -S scrot imagemagick ncftp" ;)
#
# Private version
#

#--[ Version number ]----------------------------------------------
version=1.3 #-- Re-add help argument 
#------------------------------------------------------------------

# Booleans
ftpbool=1
linkbool=1
thumbbool=1

# Ftp information
ftphost=""
ftppath=""
ftpuser=""
ftppass=""

usage() {
  echo "usage: screenshot [name]"
  echo
  echo "     test   - would make a screenshot called test.png"
  echo
  exit
}

# The date...to append to the pic ;)
today=`date +"%d.%m.%y"`

# Picture name which is appended as an argument
case "$1" in
  '-h'|'--help')
    usage
    ;;
  *)
    picname=$1
    ;;
esac

# Path to pic and thumb
pic=~/screenshots/${picname}.png
thumb=~/screenshots/${picname}t.png

link() {
  echo "Link to your freshly uploaded picture and thumbnail:";
  echo
  echo "http://$ftphost/gigamo/$ftppath/${picname}.png";
  if [ $thumbbool -eq 1 ] ; then
    echo "http://$ftphost/gigamo/$ftppath/${picname}t.png";
    echo
  else
    echo
  fi
}

printscreen() {
  `cd ~/screenshots && scrot ${picname}.png`
  if [ $thumbbool -eq 1 ] ; then
    `cd ~/screenshots && cp ${picname}.png ${picname}t.png`
    `cd ~/screenshots && mogrify -resize 25% ${picname}t.png`
  else
    echo "Chosen not to make a thumbnail, skipping";
  fi
}

upload() {
  if [ $thumbbool -eq 1 ] ; then
    `ncftpput -u $ftpuser -p $ftppass -R -m $ftphost $ftppath $pic $thumb`
  else
    `ncftpput -u $ftpuser -p $ftppass -R -m $ftphost $ftppath $pic`
  fi
}

printscreen

case "$ftpbool" in
  '1')
    upload
    if [ $linkbool -eq 1 ] ; then
      link
    else
      echo "Chosen not to display image link, skipping";
    fi
    ;;
  '0')
    echo "Chosen not to upload to FTP, exiting";
    exit
    ;;
esac
