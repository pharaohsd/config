#!/usr/bin/env ruby
# Author: Gigamo <gigamo@gmail.com>
# Wrote this because I'm too lazy to upload manually all the time
# Requires scrot, imagemagick and ncftp
FTPHOST = "users.telenet.be"
FTPPATH = "pics"
FTPUSER = ""
FTPPASS = ""
PICPATH = "~/screenshots/" # Include trailing slash or leave blank to save in working directory
NO_CLEAN = 1 # Remove the files locally afterwards or not
NO_THUMB = 0 # Make a thumbnail or not

def usage
  puts "Usage: screenshot [name]"
  puts "\n    -h, --help      - Display this"
  exit 2
end

def link
  puts "\nLink:\n\nhttp://#{FTPHOST}/gigamo/#{FTPPATH}/#{PICNAME}.png"
end

def printscreen
  if File.executable? "/usr/bin/scrot"
    if NO_THUMB == 0 and File.executable? "/usr/bin/mogrify"
      `scrot #{PICPATH}#{PICNAME}.png && cp #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png && mogrify -resize 25% #{PICPATH}#{PICNAME}t.png`
    else
      `scrot #{PICPATH}#{PICNAME}.png`
    end
  else
    puts "\nPlease install scrot"
  end
end

def upload
  if File.executable? "/usr/bin/ncftp"
    if NO_THUMB == 0
      `ncftpput -u #{FTPUSER} -p #{FTPPASS} -R -m #{FTPHOST} #{FTPPATH} #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png`
    else
      `ncftpput -u #{FTPUSER} -p #{FTPPASS} -R -m #{FTPHOST} #{FTPPATH} #{PICPATH}#{PICNAME}.png`
    end
    puts "\nUpload succesful!"
  else
    puts "\nPlease install ncftp"
  end
end

def clean
  `rm -f #{PICPATH}#{PICNAME}.png #{PICPATH}#{PICNAME}t.png`
end

if ARGV[0] == "-h" or ARGV[0] == "--help"
  usage
else
  if ARGV.empty?
    PICNAME = "current"
  else
    PICNAME = ARGV[0]
  end
  printscreen
  upload
  link
  if NO_CLEAN == 0
    clean
  end
  exit 0
end
