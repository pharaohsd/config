#!/bin/zsh
AUTHOR="Gigamo <gigamo@gmail.com>"
APP="screenshot"
VERSION="v1.0"
DESCRIPTION="Scrots a screenshot and uploads it to FTP"

RED="\033[1;31m"
GREEN="\033[1;32m"
BLUE="\033[1;34m"
END="\033[0m"

FTP_USER="users.telenet.be"
FTP_PATH="pics"
FTP_USER=""
FTP_PASS=""
PICPATH="~/screenshots/" # Include trailing slash or leave blank to save in working directory

NO_CLEAN=0
NO_THUMB=0

usage() { 
echo >&2 "$RED$APP $GREEN$VERSION$BLUE by $AUTHOR$END - $DESCRIPTION
Usage: screenshot [name]
     For example:         -   screenshot current
                          ->  would scrot a screenshot called current.png"
exit 1
}

link() {
echo >&2 "Link to uploaded picture and thumbnail:
http://$FTP_HOST/gigamo/$FTP_PATH/${PICNAME}.png"
}

printscreen() {
  if [ -x "/usr/bin/scrot" && "/usr/bin/mogrify" ]; then
    if [ $NO_THUMB -eq 0 ]; then
      (scrot ${PICPATH}${PICNAME}.png && cp ${PICPATH}${PICNAME}.png ${PICPATH}${PICNAME}t.png && mogrify -resize 25% ${PICPATH}${PICNAME}t.png)
    else
      (scrot ${PICPATH}${PICNAME}.png)
    fi
  else
    echo "${RED}Please install scrot and/or imagemagick$END"
  fi
}

upload() {
  if [ -x "/usr/bin/ncftp" ]; then
    if [ $NO_THUMB -eq 0 ]; then
      (ncftpput -u $FTP_USER -p $FTP_PASS -R -m $FTP_HOST $FTP_PATH ${PICPATH}${PICNAME}.png ${PICPATH}${PICNAME}t.png)
    else
      (ncftpput -u $FTP_USER -p $FTP_PASS -R -m $FTP_HOST $FTP_PATH ${PICPATH}${PICNAME}.png)
    fi
    echo "${GREEN}Upload succesful!$END"
  else
    echo "${RED}Please install ncftp$END"
  fi
}

clean() {
  (rm -f ${PICPATH}${PICNAME}.png ${PICPATH}${PICNAME}t.png)
}

case "$1" in
  '-h'|'--help')
    usage
    ;;
  *)
    if [ -z "$1" ]; then
      PICNAME="current"
    else
      PICNAME="$1"
    fi
    printscreen
    upload
    link
    if [ $NO_CLEAN -eq 0 ]; then
      clean
    fi
    exit 0
    ;;
esac
